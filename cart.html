<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Your Cart</title>
    <style>
         .continue-shopping {
            margin-top: 20px;
            text-align: center;
        }

        .continue-shopping .btn {
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Your Cart</h1>
    <div id="cart-items"></div>
    <div class="continue-shopping">
        <a href="index1.html"><button class="btn btn-primary">Continue Shopping</button></a>
    </div>
    <button id="clear-cart" class="btn btn-danger">Clear Cart</button>

    <script>
        // Get the cart from localStorage or initialize an empty object
        let cart = JSON.parse(localStorage.getItem('cart')) || {};

        // Function to display the cart items
        function displayCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = ''; // Clear existing items

            if (Object.keys(cart).length === 0) {
                cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
                return;
            }

            Object.keys(cart).forEach(productId => {
                const product = cart[productId];

                // Create a container for each product
                const productDiv = document.createElement('div');
                productDiv.classList.add('cart-item', 'mb-3', 'border', 'p-2');

                // Create and append the product image
                const img = document.createElement('img');
                img.src = product.image;
                img.alt = product.name;
                img.width = 100; // Adjust image size if necessary
                productDiv.appendChild(img);

                // Append the product name and price
                const name = document.createElement('p');
                name.textContent = `Name: ${product.name}`;
                productDiv.appendChild(name);

                const price = document.createElement('p');
                price.textContent = `Price: $${product.price}`;
                productDiv.appendChild(price);

                // Append the quantity controls
                const quantityDiv = document.createElement('div');
                quantityDiv.classList.add('quantity-controls');

                const decreaseButton = document.createElement('button');
                decreaseButton.textContent = '-';
                decreaseButton.classList.add('btn', 'btn-danger');
                decreaseButton.addEventListener('click', () => decreaseQuantity(productId));

                const quantity = document.createElement('span');
                quantity.textContent = product.quantity;
                quantity.classList.add('quantity', 'mx-2');

                const increaseButton = document.createElement('button');
                increaseButton.textContent = '+';
                increaseButton.classList.add('btn', 'btn-success');
                increaseButton.addEventListener('click', () => increaseQuantity(productId));

                quantityDiv.appendChild(decreaseButton);
                quantityDiv.appendChild(quantity);
                quantityDiv.appendChild(increaseButton);

                productDiv.appendChild(quantityDiv);
                cartItemsContainer.appendChild(productDiv);
            });
        }

        // Function to update the cart count in the header
        function updateCartCount() {
            const cartCount = Object.keys(cart).reduce((sum, productId) => sum + cart[productId].quantity, 0);
            localStorage.setItem('cartCount', cartCount);
        }

        // Function to increase the quantity of a product
        function increaseQuantity(productId) {
            cart[productId].quantity += 1; // Increase the quantity
            localStorage.setItem('cart', JSON.stringify(cart)); // Save updated cart to localStorage
            displayCart(); // Re-display the cart
            updateCartCount(); // Update cart count
        }

        // Function to decrease the quantity of a product
        function decreaseQuantity(productId) {
            if (cart[productId].quantity > 1) {
                cart[productId].quantity -= 1; // Decrease the quantity
            } else {
                delete cart[productId]; // Remove the item if the quantity is 1
            }
            localStorage.setItem('cart', JSON.stringify(cart)); // Save updated cart to localStorage
            displayCart(); // Re-display the cart
            updateCartCount(); // Update cart count
        }

        // Function to clear the cart
        function clearCart() {
            // Clear the cart from localStorage
            localStorage.removeItem('cart');
            cart = {}; // Reset cart object

            // Update the cart count in the original page
            localStorage.setItem('cartCount', 0); // Reset the cart count

            // Notify the user
            alert("Cart has been cleared.");
            
            // Refresh the cart display
            displayCart();
        }

        // Event listener for the "Clear Cart" button
        document.getElementById('clear-cart').addEventListener('click', function () {
            if (confirm('Are you sure you want to clear the cart?')) {
                clearCart();
            }
        });

        // Listen for localStorage changes to update cart count
        window.addEventListener('storage', function(event) {
            if (event.key === 'cartCount') {
                // This will be used on the main page, you can leave it for now
                console.log('Cart count updated:', event.newValue);
            }
        });

        // Initial call to display the cart when the page loads
        displayCart();
    </script>
</body>
</html>
